<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- UI CHANGE: The <title> tag has been removed as per your request -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --bg-color: #F8F9F5;
            --text-color: #064E3B;
            --subtle-text-color: #374151;
            --placeholder-color: #6B7280;
            --border-color: #E5E7EB;
            --accent-color: #10B981;
            
            --button-bg: #FFFFFF;
            --button-border: #D1D5DB;
            --button-hover-bg: #F9FAFB;

            --send-button-bg: #065F46;
            --send-button-hover-bg: #047857;

            --user-msg-bg: #E5E7EB;
            --user-msg-text: #1F2937;
            --ai-msg-bg: #D1FAE5;
            --ai-msg-text: #064E3B;
            
            --danger-color: #f43f5e;
        }
        html, body {
            height: 100%;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
        }
        /* Custom Scrollbars */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-color); }
        ::-webkit-scrollbar-thumb { background: #BDBDBD; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #A5A5A5; }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(12px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .animate-fade-in-up { animation: fadeInUp 0.5s ease-out forwards; }
        
        /* Markdown Styles */
        .prose { color: var(--ai-msg-text); max-width: 100%; }
        .prose h1, .prose h2, .prose h3 { color: var(--ai-msg-text); border-bottom: 1px solid rgba(0,0,0,0.1); padding-bottom: 0.3em; }
        .prose pre { background-color: #F3F4F6; color: #111827; padding: 1em; border-radius: 0.5rem; border: 1px solid var(--border-color); font-size: 0.9em; overflow-x: auto; }
        .prose code:not(pre > code) { background-color: rgba(0,0,0,0.05); padding: 0.2em 0.4em; margin: 0 0.1em; border-radius: 0.25rem; font-size: 0.85em; }
        .prose a { color: var(--send-button-bg); text-decoration: none; font-weight: 600; }
        .prose a:hover { text-decoration: underline; }

        /* General styles */
        #app {
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d1fae5' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        #message-input::placeholder {
            color: var(--placeholder-color);
        }

        .message-copy-button {
            position: absolute; top: 0.5rem; right: 0.5rem; padding: 0.375rem;
            background-color: rgba(255, 255, 255, 0.7); color: #4B5563; border-radius: 0.375rem;
            opacity: 0; transition: all 0.2s ease-in-out;
        }
        .group:hover .message-copy-button { opacity: 1; transform: scale(1); }
        .message-copy-button:hover { background-color: #fff; color: #000; transform: scale(1.1); }
    </style>
</head>
<body>
    <div id="app" class="relative flex flex-col h-full animate-fade-in">
        <!-- Header: Restyled to be subtle, functionality remains -->
        <header class="bg-transparent px-4 sm:px-6 py-3 flex items-center justify-between z-10 flex-shrink-0 gap-2">
            <!-- UI CHANGE: Added a permanent title to the header -->
            <h1 class="text-xl font-bold text-[var(--text-color)]">TBD Chat</h1>
            <div class="flex items-center gap-2 sm:gap-4">
                <select id="model-select" class="bg-[var(--button-bg)] border border-[var(--border-color)] rounded-md px-3 py-1.5 text-sm text-[var(--text-color)] focus:outline-none focus:ring-2 focus:ring-[var(--send-button-bg)] cursor-pointer hover:bg-gray-50"></select>
                <button id="clear-chat-button" title="Clear Chat" class="text-gray-400 hover:text-[var(--danger-color)] transition-all hover:scale-110">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg>
                </button>
            </div>
        </header>

        <!-- Chat Window -->
        <main id="chat-window" class="flex-1 overflow-y-auto p-6 md:p-8 space-y-6 flex flex-col justify-center"></main>

        <!-- Message Input -->
        <footer class="bg-transparent px-4 md:px-6 py-4 flex-shrink-0 z-10">
            <div class="max-w-3xl mx-auto">
                <div class="relative flex items-end bg-[var(--button-bg)] rounded-xl shadow-md ring-1 ring-inset ring-[var(--border-color)] focus-within:ring-2 focus-within:ring-[var(--send-button-bg)] transition-all">
                    <textarea id="message-input" class="w-full bg-transparent pl-4 pr-14 py-3 resize-none focus:outline-none text-[var(--text-color)] max-h-48" placeholder="Type your question here..." rows="1"></textarea>
                    <button id="send-button" class="absolute right-2.5 bottom-2.5 p-2 bg-[var(--send-button-bg)] rounded-lg text-white hover:bg-[var(--send-button-hover-bg)] disabled:bg-gray-400 disabled:cursor-not-allowed disabled:scale-100 active:scale-95 transform transition-all">
                        <svg class="w-5 h-5 -rotate-45" fill="currentColor" viewBox="0 0 20 20"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.342 1.342l14-7a1 1 0 000-1.788l-14-7z"></path></svg>
                    </button>
                </div>
            </div>
        </footer>
        
        <!-- Decorative Bottom Element -->
        <div id="bottom-decoration" class="absolute bottom-0 left-0 right-0 h-[100px] md:h-[150px] w-full pointer-events-none z-0 overflow-hidden">
            <svg viewBox="0 0 1440 320" xmlns="http://www.w3.org/2000/svg" class="absolute bottom-0" preserveAspectRatio="none"><path fill="#065f46" fill-opacity="1" d="M0,224L40,213.3C80,203,160,181,240,186.7C320,192,400,224,480,213.3C560,203,640,149,720,144C800,139,880,181,960,192C1040,203,1120,181,1200,165.3C1280,149,1360,139,1400,133.3L1440,128L1440,320L1400,320C1360,320,1280,320,1200,320C1120,320,1040,320,960,320C880,320,800,320,720,320C640,320,560,320,480,320C400,320,320,320,240,320C160,320,80,320,40,320L0,320Z"></path></svg>
             <div class="absolute w-40 h-40 md:w-56 md:h-56 bg-[#d92a3d] rounded-full" style="left: 50%; transform: translateX(-50%) translateY(60%);"></div>
        </div>

        <div id="error-banner" class="fixed top-20 right-4 p-4 rounded-lg shadow-lg bg-[var(--danger-color)] text-white z-50 hidden transition-opacity duration-300" role="alert"></div>
    </div>

    <script>
        // --- MODEL CONFIGURATION ---
        const MODEL_CONFIGS = {
            // MODEL UPDATE: Changed apiUrl to use the specific model from the Python code
            "Gemma 3": { apiKey: "AIzaSyCEpxfkyQ6g3NJ_jVyyhfReY3X6j3acBdU", apiUrl: "https://generativelanguage.googleapis.com/v1beta/models/gemma-3-27b-it:generateContent", type: "gemini" },
            "Gemini 2.5 Flash": { apiKey: "AIzaSyCGkTeb_Yjh7uDiwNvHSDHV7kTRkEJ2b78", apiUrl: "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent", type: "gemini" },
            "Gemini 2.0 Flash": { apiKey: "AIzaSyAMCpZgTg88lCr0LIqqrQnoMpieK5eHM6M", apiUrl: "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent", type: "gemini" }
        };

        // --- GLOBAL STATE & DOM REFERENCES ---
        let messages = [];
        let selectedModel = Object.keys(MODEL_CONFIGS)[0];
        
        const dom = {
            app: document.getElementById('app'),
            chatWindow: document.getElementById('chat-window'),
            messageInput: document.getElementById('message-input'),
            sendButton: document.getElementById('send-button'),
            modelSelect: document.getElementById('model-select'),
            clearChatButton: document.getElementById('clear-chat-button'),
            errorBanner: document.getElementById('error-banner'),
        };
        
        const ICONS = {
            user: `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>`,
            ai: `👋`,
            copy: `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor"><path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" /><path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" /></svg>`,
            copied: `<svg class="w-4 h-4 text-[var(--accent-color)]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>`
        };

        // --- CORE FUNCTIONS ---
        const handleSuggestionClick = (prompt) => {
            dom.messageInput.value = prompt;
            adjustTextareaHeight();
            handleSend();
        };

        const renderWelcomeScreen = () => {
            const suggestions = [
                { icon: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>`, text: 'AI Study Tips' },
                { icon: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v2a2 2 0 01-2 2H5a2 2 0 01-2-2v-2a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h4a2 2 0 012 2v2M5 15h14"></path></svg>`, text: 'Future AI Careers' },
                { icon: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>`, text: 'Responsible AI' },
                { icon: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>`, text: 'পরীক্ষার প্রস্তুতির টিপস' }
            ];

            let buttonsHTML = '';
            suggestions.forEach(s => {
                buttonsHTML += `
                    <button onclick="handleSuggestionClick('${s.text}')" class="flex items-center justify-center text-left p-4 bg-[var(--button-bg)] border border-[var(--button-border)] rounded-xl hover:bg-[var(--button-hover-bg)] hover:shadow-md transition-all duration-200 group">
                        <div class="mr-4 text-[var(--text-color)] group-hover:text-[var(--accent-color)] transition-colors">${s.icon}</div>
                        <span class="font-semibold text-md">${s.text}</span>
                    </button>
                `;
            });

            dom.chatWindow.innerHTML = `
                <div class="text-center max-w-2xl mx-auto px-4 animate-fade-in-up">
                    <h1 class="text-4xl md:text-5xl font-bold text-[var(--text-color)] mb-3">
                        <span class="inline-block mr-2 animate-wiggle">👋</span> Hi! I'm TBD Chat –
                    </h1>
                    <h2 class="text-3xl md:text-4xl font-semibold text-[var(--text-color)] mb-8">
                        your AI study buddy.<br/>How can I help you grow today?
                    </h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8">${buttonsHTML}</div>
                    <p class="text-lg text-[var(--subtle-text-color)] mb-6">
                        Ask me anything related to your studies! <br/> I'm here to make learning easier.
                    </p>
                </div>`;
            dom.chatWindow.classList.add('justify-center');
        };
        
        const createCopyButton = (textToCopy) => {
            const copyButton = document.createElement('button');
            copyButton.className = 'message-copy-button';
            copyButton.title = 'Copy message';
            copyButton.innerHTML = ICONS.copy;
            copyButton.onclick = (e) => {
                e.stopPropagation();
                navigator.clipboard.writeText(textToCopy);
                copyButton.innerHTML = ICONS.copied;
                setTimeout(() => { copyButton.innerHTML = ICONS.copy; }, 2000);
            };
            return copyButton;
        };
        
        const renderMessage = (msg) => {
            const isUser = msg.sender === 'user';
            const wrapper = document.createElement('div');
            wrapper.className = `flex items-start gap-3 animate-fade-in-up ${isUser ? 'justify-end' : ''}`;
            
            const avatar = document.createElement('div');
            avatar.className = `w-8 h-8 rounded-full flex-shrink-0 flex items-center justify-center font-semibold text-lg shadow-sm ${isUser ? 'bg-gray-700 text-white order-2' : 'bg-[var(--accent-color)] text-white'}`;
            avatar.innerHTML = isUser ? ICONS.user : ICONS.ai;
            
            const msgBubble = document.createElement('div');
            msgBubble.className = `relative group p-4 rounded-xl max-w-xl md:max-w-2xl lg:max-w-4xl shadow-sm ${isUser ? 'bg-[var(--user-msg-bg)] order-1' : 'bg-[var(--ai-msg-bg)]'}`;
            
            const prose = document.createElement('div');
            prose.className = `prose ${isUser ? 'text-[var(--user-msg-text)]' : 'text-[var(--ai-msg-text)]'}`;
            prose.innerHTML = msg.streaming ? '<div class="typing-indicator"><span></span><span></span><span></span></div>' : marked.parse(msg.text || '');
            
            msgBubble.appendChild(prose);
            msg.domElement = prose;

            if (!isUser && !msg.streaming && msg.text) {
                msgBubble.appendChild(createCopyButton(msg.text));
            }
            wrapper.appendChild(avatar);
            wrapper.appendChild(msgBubble);
            return wrapper;
        };
        
        const renderAllMessages = () => {
            dom.chatWindow.innerHTML = '';
            if (messages.length === 0) {
                renderWelcomeScreen();
                return;
            }
            dom.chatWindow.classList.remove('justify-center');
            messages.forEach(msg => dom.chatWindow.appendChild(renderMessage(msg)));
            dom.chatWindow.scrollTop = dom.chatWindow.scrollHeight;
        };

        const showError = (message) => {
            dom.errorBanner.textContent = message;
            dom.errorBanner.classList.remove('hidden', 'opacity-0');
            dom.errorBanner.classList.add('opacity-100');
            setTimeout(() => {
                dom.errorBanner.classList.remove('opacity-100');
                dom.errorBanner.classList.add('opacity-0');
                setTimeout(() => dom.errorBanner.classList.add('hidden'), 300);
            }, 5000);
        };
        
        const toggleSendButton = (enable) => {
            dom.sendButton.disabled = !enable;
            dom.messageInput.disabled = !enable;
        };

        const handleSend = async () => {
            const text = dom.messageInput.value.trim();
            if (!text || dom.sendButton.disabled) return;
            
            toggleSendButton(false);
            dom.messageInput.value = '';
            adjustTextareaHeight();

            if (messages.length === 0) {
                dom.chatWindow.innerHTML = ''; // Clear welcome screen
                dom.chatWindow.classList.remove('justify-center');
            }

            const userMessage = { sender: 'user', text };
            messages.push(userMessage);
            dom.chatWindow.appendChild(renderMessage(userMessage));
            dom.chatWindow.scrollTop = dom.chatWindow.scrollHeight;
            
            const modelConfig = MODEL_CONFIGS[selectedModel];
            const aiMessage = { sender: 'ai', text: '', streaming: true };
            messages.push(aiMessage);
            const aiMessageElement = renderMessage(aiMessage);
            dom.chatWindow.appendChild(aiMessageElement);
            dom.chatWindow.scrollTop = dom.chatWindow.scrollHeight;

            try {
                const contentsForApi = messages.slice(0, -1).map(m => ({ role: m.sender === 'user' ? 'user' : 'model', parts: [{ text: m.text }] }));
                const payload = { contents: contentsForApi, generationConfig: { temperature: 0.7 } };
                
                const response = await fetch(`${modelConfig.apiUrl}?key=${modelConfig.apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();
                if (!response.ok || result.error) throw new Error(result.error?.message || `HTTP Error ${response.status}`);
                aiMessage.text = result.candidates?.[0]?.content?.parts?.[0]?.text || "No response received.";

            } catch (error) {
                aiMessage.text = `**Error:** ${error.message}`;
                console.error('API Error:', error);
                showError(error.message);
            } finally {
                aiMessage.streaming = false;
                const proseElement = aiMessage.domElement;
                const msgBubbleElement = proseElement.parentElement;
                proseElement.innerHTML = marked.parse(aiMessage.text);
                if (msgBubbleElement && !msgBubbleElement.querySelector('.message-copy-button')) {
                    msgBubbleElement.appendChild(createCopyButton(aiMessage.text));
                }
                dom.chatWindow.scrollTop = dom.chatWindow.scrollHeight;
                toggleSendButton(true);
            }
        };

        const adjustTextareaHeight = () => {
            const textarea = dom.messageInput;
            textarea.style.height = 'auto';
            textarea.style.height = `${Math.min(textarea.scrollHeight, 192)}px`; // Capped at 192px
        };
        
        const init = () => {
            Object.keys(MODEL_CONFIGS).forEach(name => {
                const option = document.createElement('option');
                option.value = name; 
                option.innerText = name;
                dom.modelSelect.appendChild(option);
            });
            dom.modelSelect.value = selectedModel;
            renderAllMessages();

            dom.modelSelect.addEventListener('change', (e) => { selectedModel = e.target.value; });
            dom.clearChatButton.addEventListener('click', () => {
                if (confirm('Are you sure you want to clear this conversation?')) {
                    dom.chatWindow.style.opacity = '0';
                    setTimeout(() => {
                        messages = [];
                        renderAllMessages();
                        dom.chatWindow.style.opacity = '1';
                    }, 300)
                }
            });
            dom.sendButton.addEventListener('click', handleSend);
            dom.messageInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSend();
                }
            });
            dom.messageInput.addEventListener('input', adjustTextareaHeight);
            adjustTextareaHeight();
        };

        init();
    </script>
</body>
</html>